# REPRODUCIBILITY {#sec:reproducibility}

We developed the gfplot R package to conduct all the data extraction, data
manipulation, model fitting, and plotting in the data synopsis report. The
package is designed to be modular so it can be used in various capacities for
other groundfish analyses (Figure \ref{fig:gfplot-web}). For example, the
package is intended to facilitate pulling data directly into analyses for the
forthcoming management procedure framework for data-limited and data-moderate
groundfish stocks. A brief summary will follow.

TODO expand substantially on this. Mention the other R packages. Mention the
data caching. Mention how to generate the report.

\clearpage

```{r gfplot-web, fig.cap="An illustration of the gfplot functions and how they interact. \texttt{get} functions extract raw data from the relational databases, \texttt{tidy} and \texttt{fit} functions manipulate the data or fit statistical models, and \texttt{plot} functions take the output from the tidying or fitting functions to make visualizations.", out.width="4in"}
knitr::include_graphics(here::here("report", "report-rmd", "figure",
    "function-web.pdf"), dpi = NA)
```

\clearpage

This version of the document was generated on `r Sys.time()` with
`r devtools::session_info()$platform$version` [@r2018] and R package versions:

```{r env, echo = FALSE, results='asis', message=FALSE, warning=FALSE, eval=TRUE, cache=FALSE}
library(TMB)
library(rstan)
library(bookdown)
library(rmarkdown)
pkgs <- sort(c("broom", "gfplot", "ggplot2", "dplyr", "rstan", "knitr", "glmmTMB",
  "TMB", "broom.mixed", "scales", "purrr", "xtable", "kableExtra", "cowplot", "csasdown", "bookdown", "rmarkdown"))
devtools::session_info()$packages %>%
  dplyr::filter(package %in% pkgs) %>%
  dplyr::select(package, version, date) %>%
  dplyr::rename(Package = package, Version = version, Date = date) %>%
  csasdown::csas_table()
```

In particular, most of the data extraction and many of the plots were made with
the gfplot package version 0.1.1. The document was compiled with R package
csasdown version 0.0.1. The specific versions used to generate this report can
be installed with:

```{r get-git-hashes}
get_sha <- function(path) {
  suppressWarnings({
    sha <- system(paste0("git ls-remote git@github.com:", path, ".git"), 
      intern = TRUE, ignore.stderr = TRUE)
  })
  if (is.null(attr(sha, "status")))
    substr(sha[grepl("HEAD", sha)], 1, 7)
  else
    ""
}
sha_gfplot <- get_sha("pbs-assess/gfplot")
sha_gfsynopsis <- get_sha("pbs-assess/gfsynopsis")
sha_sdmTMB <- get_sha("seananderson/sdmTMB")
sha_csasdown <- get_sha("pbs-assess/csasdown")
```

`devtools::install_github('pbs-assess/gfplot', ref = '`r sha_gfplot`')`\
`devtools::install_github('pbs-assess/gfsynopsis', ref = '`r sha_gfsynopsis`')`\
`devtools::install_github('pbs-assess/sdmTMB', ref = '`r sha_sdmTMB`')`\
`devtools::install_github('pbs-assess/csasdown', ref = '`r sha_csasdown`')`\

\clearpage

